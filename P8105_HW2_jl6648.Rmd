---
title: "P8105_HW2_jl6648"
output: github_document
date: "2023-09-27"
---

```{r, message=FALSE}
library(tidyverse)
library(dplyr)
```

## problem 1
```{r, message=FALSE}
pols_df = 
  read_csv("fivethirtyeight_datasets/pols-month.csv") |>                #read dataset and clean names 
  janitor::clean_names() |> 
  separate(mon, into = c("year", "mon", "day"), sep = "-") |>            #separate the month variable
  mutate(year = as.numeric(year),  
          mon = as.numeric(mon), 
          day = as.numeric(day)) |>                                  # change new variables to numeric 
  mutate(mon = month.abb[mon],        #replace month number with name, create a new variable president
         president = case_when(prez_gop == "1" ~ "gop", prez_dem == "1" ~ "dem")) |> 
  select(-c(prez_gop, prez_dem, day))                                                  # drop variable 
```

Description of pols_df:
The dataset contains 822 observations, 9 variables including year, mon, gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem, and president. Variable mon is divided into three new variable (year, mon day). The range of year is from 1947 to 2015. president is a new variable combined with prez_gop and prez_dem. three variable (prez_gop, prez_dem, day) is dropped from original dataset. 

```{r, message=FALSE}
snp_df =
  read_csv("fivethirtyeight_datasets/snp.csv") |>           #read the dataset and clean variable names.
  janitor::clean_names() |>
  separate(date, into = c("day", "mon", "year"), sep = "/") |>            #separate the month variable
  mutate(year = as.numeric(year), 
          mon = as.numeric(mon),                                     # change new variables to numeric 
          day = as.numeric(day)) |>
  mutate(mon = month.abb[mon]) |>                                      #replace month number with name
  select(year, mon, everything(), -c(day)) |>                                         # select columns 
  relocate(year, mon)                                  #organize year and month as the leading columns
```

Description of snp_df,
the dataset contains 787 observations, three variables including year, mon, close. Use the same method to separate mon variable into year, mon, day from original dataset. Then, drop the day variable. The range of year is from 1950 to 2015. 

```{r, message=FALSE}
unemploy_df =
  read_csv("fivethirtyeight_datasets/unemployment.csv") |> #read the dataset and clean variable names.
  pivot_longer( 
      Jan:Dec,                                             #switch “wide” to “long” format
      names_to = "mon",
      values_to = "unemployment") |>
  rename(year = Year) |>                          #change the name, keep consistent with other dataset
  relocate(year, mon)                             #organize year and month as the leading columns
```

Description of unemploy_df,
The dataset contains 816 observations, three variables including year, mon, unemployment. Pivot_long function is used to reshape the data, then create a new variable unemployment. Rename the variable Year to year, keep it consistent with other dataset. The range of year is from 1948 to 2015.  

```{r, message=FALSE}
joindata_df =
  left_join(pols_df, snp_df, by = c("year", "mon")) #join the  two datasets by same column "year"&"mon"

joindata_df2 =                                                     #merging unemploy_df into the result
  left_join(joindata_df, unemploy_df,  by = c("year", "mon"))
```

Description of joindata_df and joindata_df2:
joindata_df joined by pols_df and snp_df with same column year and mon. It contains 822 observations and 10 variables. The range of year is from 1947 to 2015. 
joindata_df joined by joindata_df and unemploy_df with the same column year and mon. It contains 822 observations and 11 variables. The range of year is from 1947 to 2015.

## problem 2 

```{r, message=FALSE}
Wheel_df =
  readxl::read_excel("202309 Trash Wheel Collection Data.xlsx", 
  sheet = "Mr. Trash Wheel",                                 #read dataset with correct sheet and range
  range = "A2:N586") |>
  janitor::clean_names() |>                                                               #clean names 
  drop_na("dumpster") |>  #omit na. 
  mutate(homes_powered = weight_tons*500/30,                    #calculate the homes_powered variable 
         year = as.integer(year), 
         dataset = "Mr. Trash")                                                  #specify the dataset 
```

Description of Wheel_df:
The data contains 584 observations and 15 variables. 

```{r, message=FALSE}
professor_df =
  readxl::read_excel("202309 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  range = "A2:M108") |>                                     #read dataset with correct sheet and range
  janitor::clean_names() |>                                                               #clean names 
  drop_na("dumpster") |>
  mutate(homes_powered = weight_tons*500/30,                      #calculate the homes_powered variable
         dataset = "Professor Trash" )                                             #specify the dataset
```

Description of professor_df:
The data contains 106 observations and 14 variables. Total weight of trash is 216.26 tons. 

```{r, message=FALSE}
Gwynnda_df =
  readxl::read_excel("202309 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynnda Trash Wheel",
  range = "A2:L157") |>                                      #read dataset with correct sheet and range
  janitor::clean_names() |>                                                               #clean names 
  drop_na("dumpster") |>
  mutate(homes_powered = weight_tons*500/30,                      #calculate the homes_powered variable
         dataset = "Gwynnda Trash")                                               #specify the dataset
```

Description of Gwynnda_df:
The data contains 155 observations and 13 variables. Total cigarette butts is (3400+3900+2900+2100+4000) = 16,300. 

```{r, message=FALSE}
TrashWhell_combine =
  bind_rows(Wheel_df, professor_df, Gwynnda_df)                                 #combine these dataset 
```

Description of TrashWhell_combine:
The dataset combine three data above with 845 observations and 15 variables. 

## problem 3

```{r, message=FALSE}
baseline_mci_df =
  read_csv("data_mci/MCI_baseline.csv", na = ".") |>              #import the dataset, read . as NA
  janitor::clean_names() |>
  mutate(                                                             #mutate sex and apoe4 variable 
    sex = replace(sex, sex == 0, "Female"),
    sex = replace(sex, sex == 1, "Male"),
    apoe4 = replace(apoe4, apoe4 == 1, "Yes"),
    apoe4 = replace(apoe4, apoe4 == 0, "No")
  ) |>         #remove participants who don't develop MCI or already developed MCI before study started
  filter(!(current_age > age_at_onset | is.na(age_at_onset)))
```

There are 483 participants are recruited, 94 of them develop MCI. 

```{r, message=FALSE}
baseline_df =
  read_csv("data_mci/MCI_baseline.csv") |>                                     #same as previous chunk 
  janitor::clean_names() |>
  mutate(
    sex = replace(sex, sex == 0, "Female"),
    sex = replace(sex, sex == 1, "Male"),
    apoe4 = replace(apoe4, apoe4 == 1, "Yes"),
    apoe4 = replace(apoe4, apoe4 == 0, "No")) 
total_age =
  pull(baseline_df, current_age)                                   #calculate the mean of baseline age
  mean(total_age)
```

The average baseline age is 65.04679

```{r, message=FALSE}
filter(baseline_df, sex == "Female" & apoe4 == "Yes")             #select females who are apoe4 carrier
filter(baseline_df, sex == "Female")                                                     #select female
```

There are 211 females and 63 of them are apoe4 carriers. 63/211 = 0.298 = 29.8% Therefore, 29.8% female are  apoe4 carriers

```{r, message=FALSE}
amyloid_df =
  read_csv("data_mci/mci_amyloid.csv") |>                                             #import dataset 
  janitor::clean_names() |>
  rename(id = study_id) |>                                     #rename to make the variable consistent
  pivot_longer(
    time_2:time_8,                                                            #make the dataset longer 
    names_to = "time",
    values_to = "value"
  )
```

the study id in the "mci_amyloid.csv" dataset is inconsistent. id is the cue to find the participate appeared in both dataset. 

```{r, message=FALSE}
participant_combine =
  inner_join(baseline_mci_df, amyloid_df, by = "id")                          #join two datasets by id 
write.csv(participant_combine, "participant_combine.csv")                             #export the data
```

Some participants appear in only the baseline or amyloid dataset based on the id variable, such as id 14 only appear in baseline dataset. 